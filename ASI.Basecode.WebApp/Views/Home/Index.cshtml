@{
    ViewData["Title"] = "Home Page";
}
<div class="page-container">
    <div class="text-center">
        <h1 class="display-4">Welcome</h1>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div class="d-flex flex-row widget summary expense border rounded p-4 bg-light" style="background-color: #e9ecef;">
                <div class="d-flex flex-column justify-content-center me-3">
                    <i class="fas fa-peso-sign fa-2xl"></i>
                </div>
                <div class="d-flex flex-column m-auto">
                    <span class="lead">Total Expense</span>
                    <h1 class="display-6 fw-bold">₱@ViewData["TotalAmount"]</h1>
                    <span class="lead">Average Monthly Expense</span>
                    <h1 class="display-6 fw-bold">₱@ViewData["AverageMonthlyExpense"]</h1>
                </div>
            </div>
        </div>
    </div>


    <div class="row mt-4">
        <!-- Chart Column -->
        <div class="col-md-6">
            @if (ViewData["CategoryData"] != null)
            {
                <div class="card">
                    <div class="card-body">
                        <canvas id="donutChart" style="height: 300px;"></canvas>
                    </div>
                </div>
            }
            else
            {
                <div class="alert alert-info">No expense data available to display.</div>
            }
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Category Breakdown</h5>
                </div>
                <div class="card-body">
                    <div id="categoryList" class="list-group">
                        <!-- Categories will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        try {
            var categoryData = JSON.parse('@Html.Raw(ViewData["CategoryData"])');


            if (!categoryData || categoryData.length === 0) {
                console.log('No data available for chart');
                return;
            }

            var labels = categoryData.map(item => item.name);
            var dataValues = categoryData.map(item => item.amount);
            var colors = generateColors(categoryData.length);

            // Create the donut chart
            var ctx = document.getElementById('donutChart').getContext('2d');
            var donutChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: dataValues,
                        backgroundColor: colors.map(color => `rgba(${color}, 0.2)`),
                        borderColor: colors.map(color => `rgba(${color}, 1)`),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true // Display legend to show category names and amounts
                        },
                        tooltip: {
                            callbacks: {
                                label: function (tooltipItem) {
                                    var label = tooltipItem.label || '';
                                    var amount = tooltipItem.raw || 0;
                                    return label + ': ₱' + amount.toLocaleString();
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Expenses by Category'
                        }
                    }
                }
            });

            // Populate category list
            var categoryList = document.getElementById('categoryList');
            categoryData.forEach((category, index) => {
                var color = `rgba(${colors[index]}, 0.2)`;
                var borderColor = `rgba(${colors[index]}, 1)`;

                var listItem = document.createElement('div');
                listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                listItem.style.borderLeft = `4px solid ${borderColor}`;

                listItem.innerHTML = `
                            <div>
                                <h6 class="mb-0">${category.name}</h6>
                                <small class="text-muted">₱${category.amount.toLocaleString()}</small>
                            </div>
                            <span class="badge bg-primary rounded-pill">${category.percentage.toFixed(1)}%</span>
                        `;

                categoryList.appendChild(listItem);
            });



        } catch (error) {
            console.error('Error creating chart:', error);
        }
    });

    function generateColors(count) {
        var colors = [
            '255, 99, 132',
            '54, 162, 235',
            '255, 206, 86',
            '75, 192, 192',
            '153, 102, 255',
            '255, 159, 64'
        ];

        while (colors.length < count) {
            colors.push(`${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}`);
        }

        return colors;
    }
</script>